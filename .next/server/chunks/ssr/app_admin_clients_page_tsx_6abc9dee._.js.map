{"version":3,"sources":["../../../../app/admin/clients/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { supabase } from \"../../../utils/supabase\";\r\n\r\nexport default function ClientsPage() {\r\n    const [clients, setClients] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        fetchClients();\r\n    }, []);\r\n\r\n    async function fetchClients() {\r\n        setLoading(true);\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('*')\r\n            .eq('role', 'client')\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (!error && data) {\r\n            setClients(data);\r\n        }\r\n        setLoading(false);\r\n    }\r\n\r\n    const handleDeleteClient = async (clientId: string, clientName: string) => {\r\n        if (!window.confirm(`${clientName} isimli danışanı silmek istediğinize emin misiniz? Bu işlem geri alınamaz ve o kişiye ait tüm veriler (diyet, gelişim, kilo, giriş hesabı) kalıcı olarak silinir.`)) return;\r\n\r\n        // Yerel verileri temizle (Güvenlik amaçlı)\r\n        localStorage.removeItem(`diet_${clientId}`);\r\n        localStorage.removeItem(`dietProgress_${clientId}`);\r\n        localStorage.removeItem(`weightLogs_${clientId}`);\r\n\r\n        // Supabase Silme İşlemi (DB tarafındaki CASCADE ve TRIGGER sayesinde her şeyi siler)\r\n        const { error, count } = await supabase\r\n            .from('profiles')\r\n            .delete({ count: 'exact' })\r\n            .eq('id', clientId);\r\n\r\n        if (error) {\r\n            console.error(\"Silme hatası:\", error);\r\n            alert(\"Silme işlemi başarısız: \" + error.message);\r\n        } else if (count === 0) {\r\n            alert(\"Uyarı: Kullanıcı veritabanında bulunamadı veya silme izniniz yok (RLS). Lütfen SQL politikalarını kontrol edin.\");\r\n        } else {\r\n            // Arayüzden kaldır\r\n            setClients(clients.filter(c => c.id !== clientId));\r\n            alert(\"Danışan ve tüm verileri başarıyla silindi.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div style={{ flex: 1, padding: \"50px\", display: \"flex\", flexDirection: \"column\" }}>\r\n\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: \"40px\" }}>\r\n                    <div>\r\n                        <h1 style={{ fontSize: \"32px\", fontWeight: 700, color: \"#2c3e50\" }}>Danışan Yönetimi</h1>\r\n                        <p style={{ color: \"#7f8c8d\" }}>Sisteme kayıtlı tüm danışanlarınızın listesi ve analiz verileri.</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Clients Table */}\r\n                <div style={{ background: \"white\", borderRadius: \"20px\", overflowX: \"auto\", boxShadow: \"0 10px 20px rgba(0,0,0,0.02)\" }}>\r\n                    <table style={{ width: \"100%\", borderCollapse: \"collapse\" }}>\r\n                        <thead style={{ background: \"#fcfdfe\" }}>\r\n                            <tr style={{ textAlign: \"left\" }}>\r\n                                <th style={thStyle}>Ad Soyad</th>\r\n                                <th style={thStyle}>Boy</th>\r\n                                <th style={thStyle}>Kilo</th>\r\n                                <th style={thStyle}>VKI</th>\r\n                                <th style={thStyle}>BMH</th>\r\n                                <th style={thStyle}>Hedef</th>\r\n                                <th style={thStyle}>İşlemler</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {loading ? (\r\n                                <tr>\r\n                                    <td colSpan={7} style={{ padding: \"50px\", textAlign: \"center\", color: \"#95a5a6\" }}>\r\n                                        Yükleniyor...\r\n                                    </td>\r\n                                </tr>\r\n                            ) : clients.length > 0 ? clients.map((client) => {\r\n                                const bmi = (Number(client.weight) / ((Number(client.height) / 100) ** 2)).toFixed(1);\r\n                                const clientAge = Number(client.age) || 30; // Varsayılan 30 yaş\r\n                                const bmh = Math.round(10 * Number(client.weight) + 6.25 * Number(client.height) - 5 * clientAge + 5);\r\n\r\n                                return (\r\n                                    <tr key={client.id} style={{ borderBottom: \"1px solid #f1f1f1\" }}>\r\n                                        <td style={tdStyle}>\r\n                                            <div style={{ fontWeight: 700, color: \"#2c3e50\" }}>{client.full_name}</div>\r\n                                            <div style={{ fontSize: \"12px\", color: \"#95a5a6\" }}>{client.height} cm | {client.weight} kg</div>\r\n                                        </td>\r\n                                        <td style={tdStyle}>{client.height} cm</td>\r\n                                        <td style={tdStyle}>{client.weight} kg</td>\r\n                                        <td style={tdStyle}>\r\n                                            <span style={{\r\n                                                background: \"#f1f1f1\",\r\n                                                padding: \"4px 10px\",\r\n                                                borderRadius: \"20px\",\r\n                                                fontSize: \"13px\",\r\n                                                fontWeight: 600\r\n                                            }}>{bmi}</span>\r\n                                        </td>\r\n                                        <td style={tdStyle}>\r\n                                            <span style={{\r\n                                                background: \"#f8f9fa\",\r\n                                                color: \"#e67e22\",\r\n                                                padding: \"4px 10px\",\r\n                                                borderRadius: \"20px\",\r\n                                                fontSize: \"13px\",\r\n                                                fontWeight: 700\r\n                                            }}>{bmh} <span style={{ fontSize: \"10px\", color: \"#95a5a6\", fontWeight: \"normal\" }}>kcal</span></span>\r\n                                        </td>\r\n                                        <td style={tdStyle}>{client.target_weight} kg</td>\r\n                                        <td style={tdStyle}>\r\n                                            <div style={{ display: \"flex\", gap: \"10px\" }}>\r\n                                                <Link\r\n                                                    href={`/admin/clients/${client.id}/diet`}\r\n                                                    style={{\r\n                                                        textDecoration: \"none\",\r\n                                                        background: \"#79a33d\",\r\n                                                        color: \"white\",\r\n                                                        padding: \"8px 15px\",\r\n                                                        borderRadius: \"8px\",\r\n                                                        fontSize: \"13px\",\r\n                                                        fontWeight: 700\r\n                                                    }}\r\n                                                >\r\n                                                    Diyet Hazırla\r\n                                                </Link>\r\n                                                <button onClick={() => handleDeleteClient(client.id, client.full_name)} style={{ ...actionBtn, color: \"#e74c3c\", fontSize: \"14px\", fontWeight: \"bold\", padding: \"8px 15px\" }}>Sil</button>\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                );\r\n                            }) : (\r\n                                <tr>\r\n                                    <td colSpan={7} style={{ padding: \"50px\", textAlign: \"center\", color: \"#95a5a6\" }}>\r\n                                        Henüz kayıtlı danışan bulunmuyor.\r\n                                    </td>\r\n                                </tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nconst thStyle: React.CSSProperties = {\r\n    padding: \"20px\",\r\n    color: \"#95a5a6\",\r\n    fontSize: \"13px\",\r\n    textTransform: \"uppercase\",\r\n    letterSpacing: \"1px\",\r\n    fontWeight: 700\r\n};\r\n\r\nconst tdStyle: React.CSSProperties = {\r\n    padding: \"20px\",\r\n    color: \"#2c3e50\",\r\n    fontSize: \"15px\"\r\n};\r\n\r\nconst actionBtn: React.CSSProperties = {\r\n    background: \"none\",\r\n    border: \"none\",\r\n    cursor: \"pointer\",\r\n    fontSize: \"18px\",\r\n    padding: \"5px\",\r\n    borderRadius: \"5px\",\r\n    transition: \"background 0.3s\"\r\n};\r\n"],"names":[],"mappings":"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"}