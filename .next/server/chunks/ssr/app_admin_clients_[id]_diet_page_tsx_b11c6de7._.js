module.exports=[9892,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(50944),f=a.i(64193);function g(a){if(!a||"string"!=typeof a)return null;let b=a.trim().replace(",",".").match(/^([\d.]+)\s*(.*)?$/);if(!b)return null;let c=parseFloat(b[1]);if(isNaN(c))return null;let d=(b[2]||"").toLowerCase().trim();return["g","gr","gram"].includes(d)?d="gram":["adet","tane"].includes(d)&&(d="adet"),{amount:c,unit:d}}function h(){let a=(0,e.useParams)(),h=(0,e.useRouter)(),l=a?.id,[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(0),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)({}),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)([{day:1,breakfast:[],lunch:[],dinner:[],snacks:[]}]);(0,c.useEffect)(()=>{l&&a();async function a(){v(!0);let{data:a}=await f.supabase.from("profiles").select("*").eq("id",l).single();a&&n(a);let{data:b}=await f.supabase.from("diets").select("*").eq("client_id",l).eq("is_active",!0).maybeSingle();b&&b.content&&x(b.content);let{data:c}=await f.supabase.from("food_library").select("*");c&&r(c);let{data:d}=await f.supabase.from("diet_progress").select("*").eq("client_id",l);if(d){let a={};d.forEach(b=>{a[b.day_number-1]={completed:b.is_completed,note:b.note}}),t(a)}v(!1)}},[l]);let y=(a,b,c,d)=>{x(e=>e.map((e,f)=>{if(f===o){let f=[...e[a]||[]];if(f[b]={...f[b],[c]:d},"portion"===c){let a=f[b].food,c=q.find(b=>b.name===a);if(c){let a=function(a,b){if(!a||!b||!b.unit||void 0===b.cal)return null;let c=g(a),d=g(String(b.unit));if(!c||!d||0===d.amount)return null;let e=Number(b.cal);if(isNaN(e))return null;let f=!1;return(c.unit===d.unit||""===c.unit?f=!0:""===d.unit&&(f=!0),f)?Math.round(e*(c.amount/d.amount)):null}(String(d),c);null!==a&&(f[b].cal=a)}}return{...e,[a]:f}}return e}))},z=async()=>{if(!l)return;v(!0),await f.supabase.from("diets").update({is_active:!1}).eq("client_id",l);let{error:a}=await f.supabase.from("diets").insert([{client_id:l,title:`${w.length} G\xfcnl\xfck Program`,content:w,is_active:!0}]);a?alert("Diyet kaydedilemedi: "+a.message):(alert("Diyet listesi Supabase'e başarıyla kaydedildi!"),h.push("/admin/clients")),v(!1)};return u?(0,b.jsx)("div",{children:"Veriler yükleniyor..."}):m&&w[o]?(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{style:{flex:1,padding:"50px",display:"flex",flexDirection:"column"},children:[(0,b.jsxs)("div",{style:{marginBottom:"40px"},children:[(0,b.jsx)(d.default,{href:"/admin/clients",style:{color:"#79a33d",textDecoration:"none",fontSize:"14px",fontWeight:700},children:"← Listeye Dön"}),(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"},children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{style:{fontSize:"32px",fontWeight:700,color:"#2c3e50"},children:["Diyet Hazırla: ",m.name]}),(0,b.jsx)("p",{style:{color:"#7f8c8d"},children:"Danışan için öğün detaylarını gün gün planlayabilirsiniz."})]}),(0,b.jsxs)("button",{onClick:z,style:k,children:["Diyet Listesini ",w.length," Günlük Kaydet"]})]})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:"10px",marginBottom:"25px",overflowX:"auto",paddingBottom:"10px"},children:[w.map((a,c)=>(0,b.jsxs)("div",{style:{position:"relative"},children:[(0,b.jsxs)("button",{onClick:()=>p(c),style:{padding:"12px 25px",background:o===c?"#79a33d":"white",color:o===c?"white":"#2c3e50",border:`1px solid ${o===c?"#79a33d":"#e0e0e0"} `,borderRadius:"10px",fontWeight:700,cursor:"pointer",transition:"all 0.2s"},children:[c+1,". Gün"]}),w.length>1&&(0,b.jsx)("button",{onClick:()=>(a=>{if(1===w.length)return alert("En az 1 gün olmalı!");let b=w.filter((b,c)=>c!==a).map((a,b)=>({...a,day:b+1}));x(b),p(Math.min(o,b.length-1))})(c),style:{position:"absolute",top:"-8px",right:"-8px",background:"#e74c3c",color:"white",border:"none",borderRadius:"50%",width:"22px",height:"22px",fontSize:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Günü Sil",children:"X"})]},c)),(0,b.jsx)("button",{onClick:()=>{x([...w,{day:w.length+1,breakfast:[],lunch:[],dinner:[],snacks:[]}]),p(w.length)},style:{padding:"12px 25px",background:"transparent",color:"#79a33d",border:"2px dashed #79a33d",borderRadius:"10px",fontWeight:700,cursor:"pointer"},children:"+ Yeni Gün Ekle"})]}),(0,b.jsxs)("div",{style:{marginBottom:"30px",background:s[o]?.completed?"#eaf2e3":"white",padding:"20px 30px",borderRadius:"15px",border:`1px solid ${s[o]?.completed?"#79a33d":"#eee"} `,display:"flex",alignItems:"flex-start",gap:"20px"},children:[(0,b.jsx)("div",{style:{fontSize:"24px",background:s[o]?.completed?"#79a33d":"#f0f0f0",color:s[o]?.completed?"white":"#ccc",width:"50px",height:"50px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:s[o]?.completed?"✓":"!"}),(0,b.jsxs)("div",{style:{flex:1},children:[(0,b.jsx)("h3",{style:{fontSize:"16px",fontWeight:700,color:s[o]?.completed?"#3d5a2d":"#7f8c8d",marginBottom:"5px"},children:s[o]?.completed?"Danışan bu günü eksiksiz uyguladı!":"Bu gün için henüz onay verilmedi."}),s[o]?.note?(0,b.jsxs)("div",{style:{marginTop:"10px",padding:"15px",background:"white",borderRadius:"10px",fontSize:"14px",color:"#555",fontStyle:"italic",borderLeft:"4px solid #79a33d"},children:['"',s[o].note,'"']}):(0,b.jsx)("p",{style:{fontSize:"13px",color:"#95a5a6",marginTop:"5px"},children:"Danışan herhangi bir not bırakmadı."})]})]}),(0,b.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:["breakfast","lunch","dinner","snacks"].map(a=>(0,b.jsxs)("div",{style:{background:"white",padding:"30px",borderRadius:"20px",boxShadow:"0 10px 20px rgba(0,0,0,0.02)"},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,b.jsx)("h3",{style:{fontSize:"18px",fontWeight:700,color:"#3d5a2d",textTransform:"capitalize"},children:"breakfast"===a?"Kahvaltı":"lunch"===a?"Öğle Yemeği":"dinner"===a?"Akşam Yemeği":"Ara Öğünler"}),(0,b.jsx)("button",{onClick:()=>{x(b=>b.map((b,c)=>{if(c===o){let c=b[a]||[];return{...b,[a]:[...c,{food:"",portion:"",cal:0}]}}return b}))},style:j,children:"+ Satır Ekle"})]}),(0,b.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{style:{textAlign:"left",fontSize:"13px",color:"#95a5a6",textTransform:"uppercase"},children:[(0,b.jsx)("th",{style:{padding:"10px",width:"40%"},children:"Besin"}),(0,b.jsx)("th",{style:{padding:"10px",width:"30%"},children:"Porsiyon"}),(0,b.jsx)("th",{style:{padding:"10px",width:"20%"},children:"Kalori"}),(0,b.jsx)("th",{style:{padding:"10px",width:"10%"}})]})}),(0,b.jsxs)("tbody",{children:[(w[o][a]||[]).map((c,d)=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:{padding:"5px"},children:(0,b.jsx)("input",{value:c.food,onChange:b=>{var c;let e;return c=b.target.value,e=q.find(a=>a.name===c),void x(b=>b.map((b,f)=>{if(f===o){let f=[...b[a]||[]];return f[d]={...f[d],food:c},e&&(f[d].portion=e.unit,f[d].cal=e.cal),{...b,[a]:f}}return b}))},list:"food-suggestions",style:i,placeholder:"Besin adı..."})}),(0,b.jsx)("td",{style:{padding:"5px"},children:(0,b.jsx)("input",{value:c.portion,onChange:b=>y(a,d,"portion",b.target.value),style:i,placeholder:"100g, 1 porsiyon..."})}),(0,b.jsx)("td",{style:{padding:"5px"},children:(0,b.jsx)("input",{type:"number",value:c.cal,onChange:b=>y(a,d,"cal",b.target.value),style:i})}),(0,b.jsx)("td",{style:{padding:"5px",textAlign:"center"},children:(0,b.jsx)("button",{onClick:()=>{x(b=>b.map((b,c)=>{if(c===o){let c=[...b[a]||[]];return c.splice(d,1),{...b,[a]:c}}return b}))},style:{background:"none",border:"none",color:"#e74c3c",cursor:"pointer",fontWeight:700},children:"Sil"})})]},d)),0===(w[o][a]||[]).length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:4,style:{padding:"20px",textAlign:"center",color:"#95a5a6",fontSize:"14px"},children:"Bu öğüne henüz besin eklenmedi."})})]})]})]},a))}),(0,b.jsx)("datalist",{id:"food-suggestions",children:q.map((a,c)=>(0,b.jsx)("option",{value:a.name},c))})]})}):(0,b.jsx)("div",{children:"Hata: Danışan bulunamadı."})}let i={width:"100%",padding:"10px 15px",borderRadius:"8px",border:"1px solid #eee",fontSize:"14px",color:"#333",fontWeight:600},j={background:"none",border:"1px solid #79a33d",color:"#79a33d",padding:"8px 15px",borderRadius:"8px",fontWeight:700,cursor:"pointer"},k={background:"#79a33d",color:"white",border:"none",padding:"15px 40px",borderRadius:"10px",fontSize:"16px",fontWeight:700,cursor:"pointer",boxShadow:"0 10px 20px rgba(121, 163, 61, 0.2)"};a.s(["default",()=>h],9892)}];

//# sourceMappingURL=app_admin_clients_%5Bid%5D_diet_page_tsx_b11c6de7._.js.map