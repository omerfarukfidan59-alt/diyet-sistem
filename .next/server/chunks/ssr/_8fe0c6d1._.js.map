{"version":3,"sources":["../../../../utils/supabase.ts","../../../../app/dashboard/page.tsx"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\n// Bu instance, sadece anonim veya login olmuş kullanıcıların erişebileceği yetkilerle çalışır (Row Level Security - RLS kurallarına uyar)\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\r\n","\"use client\";\r\n\r\n// No strict change here. Just fulfilling tool expectations. \r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"../../utils/supabase\";\r\n\r\nexport default function DashboardPage() {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState({\r\n        name: \"Yükleniyor...\",\r\n        height: 180,\r\n        weight: 85,\r\n        age: 28,\r\n        targetWeight: 75,\r\n        gender: \"Erkek\"\r\n    });\r\n\r\n    const [dietDay, setDietDay] = useState<any>(null);\r\n    const [activeDayIndex, setActiveDayIndex] = useState(0);\r\n\r\n    useEffect(() => {\r\n        async function fetchUserData() {\r\n            // 1. Supabase Session Kontrolü\r\n            const { data: authData } = await supabase.auth.getUser();\r\n\r\n            if (!authData.user) {\r\n                // Yedek: localStorage kontrolü\r\n                const loggedInUser = localStorage.getItem(\"currentUser\");\r\n                if (!loggedInUser) {\r\n                    router.push(\"/login\");\r\n                    return;\r\n                }\r\n                const parsedUser = JSON.parse(loggedInUser);\r\n                if (parsedUser.role === \"admin\") {\r\n                    router.push(\"/admin\");\r\n                    return;\r\n                }\r\n                setUser({\r\n                    name: parsedUser.name || parsedUser.full_name,\r\n                    height: Number(parsedUser.height),\r\n                    weight: Number(parsedUser.weight),\r\n                    age: Number(parsedUser.age),\r\n                    targetWeight: Number(parsedUser.targetWeight || parsedUser.target_weight),\r\n                    gender: parsedUser.gender || \"Erkek\"\r\n                });\r\n                return;\r\n            }\r\n\r\n            // 2. Supabase DB'den Profil Çekme\r\n            const { data: profile } = await supabase\r\n                .from('profiles')\r\n                .select('*')\r\n                .eq('id', authData.user.id)\r\n                .single();\r\n\r\n            if (profile) {\r\n                if (profile.role === \"admin\") {\r\n                    router.push(\"/admin\");\r\n                    return;\r\n                }\r\n                setUser({\r\n                    name: profile.full_name,\r\n                    height: Number(profile.height),\r\n                    weight: Number(profile.weight),\r\n                    age: Number(profile.age),\r\n                    targetWeight: Number(profile.target_weight),\r\n                    gender: profile.gender || \"Erkek\"\r\n                });\r\n            }\r\n\r\n            // 3. Diyeti Supabase'den Çek\r\n            const { data: dietData } = await supabase\r\n                .from('diets')\r\n                .select('*')\r\n                .eq('client_id', authData.user.id)\r\n                .eq('is_active', true)\r\n                .maybeSingle();\r\n\r\n            if (dietData && dietData.content && Array.isArray(dietData.content)) {\r\n                // İlerlemeyi Çek (Günü belirlemek için)\r\n                const { data: progressData } = await supabase\r\n                    .from('diet_progress')\r\n                    .select('*')\r\n                    .eq('client_id', authData.user.id)\r\n                    .order('day_number', { ascending: false })\r\n                    .limit(1);\r\n\r\n                let currentDayIdx = 0;\r\n                if (progressData && progressData.length > 0) {\r\n                    currentDayIdx = progressData[0].day_number - 1;\r\n                    if (currentDayIdx >= dietData.content.length) {\r\n                        currentDayIdx = dietData.content.length - 1;\r\n                    }\r\n                }\r\n\r\n                setActiveDayIndex(currentDayIdx);\r\n                setDietDay(dietData.content[currentDayIdx]);\r\n            }\r\n        }\r\n\r\n        fetchUserData();\r\n    }, [router]);\r\n\r\n    const handleLogout = async () => {\r\n        await supabase.auth.signOut();\r\n        localStorage.removeItem(\"currentUser\");\r\n        router.push(\"/\");\r\n    };\r\n\r\n    // VKI ve BMH Hesaplama\r\n    const heightInMeters = user.height / 100;\r\n    const bmi = (user.weight / (heightInMeters * heightInMeters)).toFixed(1);\r\n\r\n    // BMH Hedef Kilo üzerinden hesabı\r\n    let bmr = 0;\r\n    const targetW = user.targetWeight || user.weight; // Hedef kilo yoksa mevcut kiloyu al\r\n\r\n    if (user.gender === 'Kadın') {\r\n        bmr = Math.round(10 * targetW + 6.25 * user.height - 5 * user.age - 161);\r\n    } else {\r\n        bmr = Math.round(10 * targetW + 6.25 * user.height - 5 * user.age + 5);\r\n    }\r\n\r\n    const getBmiStatus = (val: number) => {\r\n        if (val < 18.5) return { text: \"Zayıf\", color: \"#f39c12\" };\r\n        if (val < 25) return { text: \"Normal\", color: \"#27ae60\" };\r\n        if (val < 30) return { text: \"Fazla Kilolu\", color: \"#e67e22\" };\r\n        return { text: \"Obez\", color: \"#e74c3c\" };\r\n    };\r\n\r\n    const bmiStatus = getBmiStatus(parseFloat(bmi));\r\n\r\n    return (\r\n        <div style={{ flex: 1, padding: \"40px\", display: \"flex\", flexDirection: \"column\" }}>\r\n\r\n            <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: \"40px\" }}>\r\n                <div>\r\n                    <h1 style={{ fontSize: \"28px\", color: \"#333\", fontWeight: 700 }}>Hoş geldin, {user.name}!</h1>\r\n                    <p style={{ color: \"#666\" }}>Bugün sağlıklı seçimler yapmak için harika bir gün.</p>\r\n                </div>\r\n                <div style={{ textAlign: \"right\" }}>\r\n                    <div style={{ fontSize: \"14px\", color: \"#888\" }}>Tarih</div>\r\n                    <div style={{ fontWeight: 600, color: \"#333\" }}>21 Şubat 2026</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Info Cards Grid */}\r\n            <div style={{ display: \"grid\", gridTemplateColumns: \"1fr 1fr 1fr\", gap: \"25px\", marginBottom: \"40px\" }} className=\"stats-grid\">\r\n\r\n                {/* Card: BMI */}\r\n                <div style={statCard}>\r\n                    <div style={{ fontSize: \"14px\", color: \"#888\", marginBottom: \"5px\" }}>Vücut Kitle İndeksi (VKI)</div>\r\n                    <div style={{ display: \"flex\", alignItems: \"baseline\", gap: \"10px\" }}>\r\n                        <span style={{ fontSize: \"32px\", fontWeight: 800, color: \"#333\" }}>{bmi}</span>\r\n                        <span style={{\r\n                            fontSize: \"12px\",\r\n                            padding: \"4px 8px\",\r\n                            borderRadius: \"20px\",\r\n                            background: bmiStatus.color + \"22\",\r\n                            color: bmiStatus.color,\r\n                            fontWeight: 700\r\n                        }}>\r\n                            {bmiStatus.text}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Card: BMR */}\r\n                <div style={statCard}>\r\n                    <div style={{ fontSize: \"14px\", color: \"#888\", marginBottom: \"5px\" }}>Bazal Metabolizma Hızı (BMH)</div>\r\n                    <div style={{ display: \"flex\", alignItems: \"baseline\", gap: \"5px\" }}>\r\n                        <span style={{ fontSize: \"32px\", fontWeight: 800, color: \"#333\" }}>{bmr}</span>\r\n                        <span style={{ fontSize: \"14px\", color: \"#666\" }}>kcal/gün</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Card: Progress */}\r\n                <div style={statCard}>\r\n                    <div style={{ fontSize: \"14px\", color: \"#888\", marginBottom: \"5px\" }}>Hedefe Kalan</div>\r\n                    <div style={{ display: \"flex\", alignItems: \"baseline\", gap: \"5px\" }}>\r\n                        <span style={{ fontSize: \"32px\", fontWeight: 800, color: \"#79a33d\" }}>{user.weight - user.targetWeight}</span>\r\n                        <span style={{ fontSize: \"14px\", color: \"#666\" }}>kg</span>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            <style jsx>{`\r\n                @media (max-width: 1024px) {\r\n                    .stats-grid { grid-template-columns: 1fr !important; }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst statCard: React.CSSProperties = {\r\n    background: \"white\",\r\n    padding: \"25px\",\r\n    borderRadius: \"15px\",\r\n    boxShadow: \"0 10px 30px rgba(0,0,0,0.03)\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    justifyContent: \"center\"\r\n};\r\n"],"names":[],"mappings":"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"}