{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/GamerPC/OneDrive/Desktop/diyet-sistem/utils/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\n// Bu instance, sadece anonim veya login olmuş kullanıcıların erişebileceği yetkilerle çalışır (Row Level Security - RLS kurallarına uyar)\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAGC,MAAM,WAAW,IAAA,8LAAY,EAAC,aAAa"}},
    {"offset": {"line": 17, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/GamerPC/OneDrive/Desktop/diyet-sistem/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\n// No strict change here. Just fulfilling tool expectations. \r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"../../utils/supabase\";\r\n\r\nexport default function DashboardPage() {\r\n    const router = useRouter();\r\n    const [user, setUser] = useState({\r\n        name: \"Yükleniyor...\",\r\n        height: 180,\r\n        weight: 85,\r\n        age: 28,\r\n        targetWeight: 75,\r\n        gender: \"Erkek\"\r\n    });\r\n\r\n    const [dietDay, setDietDay] = useState<any>(null);\r\n    const [activeDayIndex, setActiveDayIndex] = useState(0);\r\n\r\n    useEffect(() => {\r\n        async function fetchUserData() {\r\n            // 1. Supabase Session Kontrolü\r\n            const { data: authData } = await supabase.auth.getUser();\r\n\r\n            if (!authData.user) {\r\n                // Yedek: localStorage kontrolü\r\n                const loggedInUser = localStorage.getItem(\"currentUser\");\r\n                if (!loggedInUser) {\r\n                    router.push(\"/login\");\r\n                    return;\r\n                }\r\n                const parsedUser = JSON.parse(loggedInUser);\r\n                if (parsedUser.role === \"admin\") {\r\n                    router.push(\"/admin\");\r\n                    return;\r\n                }\r\n                setUser({\r\n                    name: parsedUser.name || parsedUser.full_name,\r\n                    height: Number(parsedUser.height),\r\n                    weight: Number(parsedUser.weight),\r\n                    age: Number(parsedUser.age),\r\n                    targetWeight: Number(parsedUser.targetWeight || parsedUser.target_weight),\r\n                    gender: parsedUser.gender || \"Erkek\"\r\n                });\r\n                return;\r\n            }\r\n\r\n            // 2. Supabase DB'den Profil Çekme\r\n            const { data: profile } = await supabase\r\n                .from('profiles')\r\n                .select('*')\r\n                .eq('id', authData.user.id)\r\n                .single();\r\n\r\n            if (profile) {\r\n                if (profile.role === \"admin\") {\r\n                    router.push(\"/admin\");\r\n                    return;\r\n                }\r\n                setUser({\r\n                    name: profile.full_name,\r\n                    height: Number(profile.height),\r\n                    weight: Number(profile.weight),\r\n                    age: Number(profile.age),\r\n                    targetWeight: Number(profile.target_weight),\r\n                    gender: profile.gender || \"Erkek\"\r\n                });\r\n            }\r\n\r\n            // 3. Diyeti Supabase'den Çek\r\n            const { data: dietData } = await supabase\r\n                .from('diets')\r\n                .select('*')\r\n                .eq('client_id', authData.user.id)\r\n                .eq('is_active', true)\r\n                .maybeSingle();\r\n\r\n            if (dietData && dietData.content && Array.isArray(dietData.content)) {\r\n                // İlerlemeyi Çek (Günü belirlemek için)\r\n                const { data: progressData } = await supabase\r\n                    .from('diet_progress')\r\n                    .select('*')\r\n                    .eq('client_id', authData.user.id)\r\n                    .order('day_number', { ascending: false })\r\n                    .limit(1);\r\n\r\n                let currentDayIdx = 0;\r\n                if (progressData && progressData.length > 0) {\r\n                    currentDayIdx = progressData[0].day_number - 1;\r\n                    if (currentDayIdx >= dietData.content.length) {\r\n                        currentDayIdx = dietData.content.length - 1;\r\n                    }\r\n                }\r\n\r\n                setActiveDayIndex(currentDayIdx);\r\n                setDietDay(dietData.content[currentDayIdx]);\r\n            }\r\n        }\r\n\r\n        fetchUserData();\r\n    }, [router]);\r\n\r\n    const handleLogout = async () => {\r\n        await supabase.auth.signOut();\r\n        localStorage.removeItem(\"currentUser\");\r\n        router.push(\"/\");\r\n    };\r\n\r\n    // VKI ve BMH Hesaplama\r\n    const heightInMeters = user.height / 100;\r\n    const bmi = (user.weight / (heightInMeters * heightInMeters)).toFixed(1);\r\n\r\n    // BMH Hedef Kilo üzerinden hesabı\r\n    let bmr = 0;\r\n    const targetW = user.targetWeight || user.weight; // Hedef kilo yoksa mevcut kiloyu al\r\n\r\n    if (user.gender === 'Kadın') {\r\n        bmr = Math.round(10 * targetW + 6.25 * user.height - 5 * user.age - 161);\r\n    } else {\r\n        bmr = Math.round(10 * targetW + 6.25 * user.height - 5 * user.age + 5);\r\n    }\r\n\r\n    const getBmiStatus = (val: number) => {\r\n        if (val < 18.5) return { text: \"Zayıf\", color: \"#f39c12\" };\r\n        if (val < 25) return { text: \"Normal\", color: \"#27ae60\" };\r\n        if (val < 30) return { text: \"Fazla Kilolu\", color: \"#e67e22\" };\r\n        return { text: \"Obez\", color: \"#e74c3c\" };\r\n    };\r\n\r\n    const bmiStatus = getBmiStatus(parseFloat(bmi));\r\n\r\n    return (\r\n        <div style={{ flex: 1, padding: \"40px\", display: \"flex\", flexDirection: \"column\" }}>\r\n\r\n            <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: \"40px\" }}>\r\n                <div>\r\n                    <h1 style={{ fontSize: \"28px\", color: \"#333\", fontWeight: 700 }}>Hoş geldin, {user.name}!</h1>\r\n                    <p style={{ color: \"#666\" }}>Bugün sağlıklı seçimler yapmak için harika bir gün.</p>\r\n                </div>\r\n                <div style={{ textAlign: \"right\" }}>\r\n                    <div style={{ fontSize: \"14px\", color: \"#888\" }}>Tarih</div>\r\n                    <div style={{ fontWeight: 600, color: \"#333\" }}>21 Şubat 2026</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Info Cards Grid */}\r\n            <div style={{ display: \"grid\", gridTemplateColumns: \"1fr 1fr 1fr\", gap: \"25px\", marginBottom: \"40px\" }} className=\"stats-grid\">\r\n\r\n                {/* Card: BMI */}\r\n                <div style={statCard}>\r\n                    <div style={{ fontSize: \"14px\", color: \"#888\", marginBottom: \"5px\" }}>Vücut Kitle İndeksi (VKI)</div>\r\n                    <div style={{ display: \"flex\", alignItems: \"baseline\", gap: \"10px\" }}>\r\n                        <span style={{ fontSize: \"32px\", fontWeight: 800, color: \"#333\" }}>{bmi}</span>\r\n                        <span style={{\r\n                            fontSize: \"12px\",\r\n                            padding: \"4px 8px\",\r\n                            borderRadius: \"20px\",\r\n                            background: bmiStatus.color + \"22\",\r\n                            color: bmiStatus.color,\r\n                            fontWeight: 700\r\n                        }}>\r\n                            {bmiStatus.text}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Card: BMR */}\r\n                <div style={statCard}>\r\n                    <div style={{ fontSize: \"14px\", color: \"#888\", marginBottom: \"5px\" }}>Bazal Metabolizma Hızı (BMH)</div>\r\n                    <div style={{ display: \"flex\", alignItems: \"baseline\", gap: \"5px\" }}>\r\n                        <span style={{ fontSize: \"32px\", fontWeight: 800, color: \"#333\" }}>{bmr}</span>\r\n                        <span style={{ fontSize: \"14px\", color: \"#666\" }}>kcal/gün</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Card: Progress */}\r\n                <div style={statCard}>\r\n                    <div style={{ fontSize: \"14px\", color: \"#888\", marginBottom: \"5px\" }}>Hedefe Kalan</div>\r\n                    <div style={{ display: \"flex\", alignItems: \"baseline\", gap: \"5px\" }}>\r\n                        <span style={{ fontSize: \"32px\", fontWeight: 800, color: \"#79a33d\" }}>{user.weight - user.targetWeight}</span>\r\n                        <span style={{ fontSize: \"14px\", color: \"#666\" }}>kg</span>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            <style jsx>{`\r\n                @media (max-width: 1024px) {\r\n                    .stats-grid { grid-template-columns: 1fr !important; }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst statCard: React.CSSProperties = {\r\n    background: \"white\",\r\n    padding: \"25px\",\r\n    borderRadius: \"15px\",\r\n    boxShadow: \"0 10px 30px rgba(0,0,0,0.03)\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    justifyContent: \"center\"\r\n};\r\n"],"names":[],"mappings":";;;;;;AAEA,6DAA6D;AAC7D;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACpB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;QAC7B,MAAM;QACN,QAAQ;QACR,QAAQ;QACR,KAAK;QACL,cAAc;QACd,QAAQ;IACZ;IAEA,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAM;IAC5C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAC;IAErD,IAAA,kNAAS,EAAC;QACN,eAAe;YACX,+BAA+B;YAC/B,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,6HAAQ,CAAC,IAAI,CAAC,OAAO;YAEtD,IAAI,CAAC,SAAS,IAAI,EAAE;gBAChB,+BAA+B;gBAC/B,MAAM,eAAe,aAAa,OAAO,CAAC;gBAC1C,IAAI,CAAC,cAAc;oBACf,OAAO,IAAI,CAAC;oBACZ;gBACJ;gBACA,MAAM,aAAa,KAAK,KAAK,CAAC;gBAC9B,IAAI,WAAW,IAAI,KAAK,SAAS;oBAC7B,OAAO,IAAI,CAAC;oBACZ;gBACJ;gBACA,QAAQ;oBACJ,MAAM,WAAW,IAAI,IAAI,WAAW,SAAS;oBAC7C,QAAQ,OAAO,WAAW,MAAM;oBAChC,QAAQ,OAAO,WAAW,MAAM;oBAChC,KAAK,OAAO,WAAW,GAAG;oBAC1B,cAAc,OAAO,WAAW,YAAY,IAAI,WAAW,aAAa;oBACxE,QAAQ,WAAW,MAAM,IAAI;gBACjC;gBACA;YACJ;YAEA,kCAAkC;YAClC,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,6HAAQ,CACnC,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,SAAS,IAAI,CAAC,EAAE,EACzB,MAAM;YAEX,IAAI,SAAS;gBACT,IAAI,QAAQ,IAAI,KAAK,SAAS;oBAC1B,OAAO,IAAI,CAAC;oBACZ;gBACJ;gBACA,QAAQ;oBACJ,MAAM,QAAQ,SAAS;oBACvB,QAAQ,OAAO,QAAQ,MAAM;oBAC7B,QAAQ,OAAO,QAAQ,MAAM;oBAC7B,KAAK,OAAO,QAAQ,GAAG;oBACvB,cAAc,OAAO,QAAQ,aAAa;oBAC1C,QAAQ,QAAQ,MAAM,IAAI;gBAC9B;YACJ;YAEA,6BAA6B;YAC7B,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,6HAAQ,CACpC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,aAAa,SAAS,IAAI,CAAC,EAAE,EAChC,EAAE,CAAC,aAAa,MAChB,WAAW;YAEhB,IAAI,YAAY,SAAS,OAAO,IAAI,MAAM,OAAO,CAAC,SAAS,OAAO,GAAG;gBACjE,wCAAwC;gBACxC,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,6HAAQ,CACxC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,aAAa,SAAS,IAAI,CAAC,EAAE,EAChC,KAAK,CAAC,cAAc;oBAAE,WAAW;gBAAM,GACvC,KAAK,CAAC;gBAEX,IAAI,gBAAgB;gBACpB,IAAI,gBAAgB,aAAa,MAAM,GAAG,GAAG;oBACzC,gBAAgB,YAAY,CAAC,EAAE,CAAC,UAAU,GAAG;oBAC7C,IAAI,iBAAiB,SAAS,OAAO,CAAC,MAAM,EAAE;wBAC1C,gBAAgB,SAAS,OAAO,CAAC,MAAM,GAAG;oBAC9C;gBACJ;gBAEA,kBAAkB;gBAClB,WAAW,SAAS,OAAO,CAAC,cAAc;YAC9C;QACJ;QAEA;IACJ,GAAG;QAAC;KAAO;IAEX,MAAM,eAAe;QACjB,MAAM,6HAAQ,CAAC,IAAI,CAAC,OAAO;QAC3B,aAAa,UAAU,CAAC;QACxB,OAAO,IAAI,CAAC;IAChB;IAEA,uBAAuB;IACvB,MAAM,iBAAiB,KAAK,MAAM,GAAG;IACrC,MAAM,MAAM,CAAC,KAAK,MAAM,GAAG,CAAC,iBAAiB,cAAc,CAAC,EAAE,OAAO,CAAC;IAEtE,kCAAkC;IAClC,IAAI,MAAM;IACV,MAAM,UAAU,KAAK,YAAY,IAAI,KAAK,MAAM,EAAE,oCAAoC;IAEtF,IAAI,KAAK,MAAM,KAAK,SAAS;QACzB,MAAM,KAAK,KAAK,CAAC,KAAK,UAAU,OAAO,KAAK,MAAM,GAAG,IAAI,KAAK,GAAG,GAAG;IACxE,OAAO;QACH,MAAM,KAAK,KAAK,CAAC,KAAK,UAAU,OAAO,KAAK,MAAM,GAAG,IAAI,KAAK,GAAG,GAAG;IACxE;IAEA,MAAM,eAAe,CAAC;QAClB,IAAI,MAAM,MAAM,OAAO;YAAE,MAAM;YAAS,OAAO;QAAU;QACzD,IAAI,MAAM,IAAI,OAAO;YAAE,MAAM;YAAU,OAAO;QAAU;QACxD,IAAI,MAAM,IAAI,OAAO;YAAE,MAAM;YAAgB,OAAO;QAAU;QAC9D,OAAO;YAAE,MAAM;YAAQ,OAAO;QAAU;IAC5C;IAEA,MAAM,YAAY,aAAa,WAAW;IAE1C,qBACI,8OAAC;QAAI,OAAO;YAAE,MAAM;YAAG,SAAS;YAAQ,SAAS;YAAQ,eAAe;QAAS;;;0BAE7E,8OAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,gBAAgB;oBAAiB,YAAY;oBAAU,cAAc;gBAAO;;;kCACvG,8OAAC;;;0CACG,8OAAC;gCAAG,OAAO;oCAAE,UAAU;oCAAQ,OAAO;oCAAQ,YAAY;gCAAI;;;oCAAG;oCAAa,KAAK,IAAI;oCAAC;;;;;;;0CACxF,8OAAC;gCAAE,OAAO;oCAAE,OAAO;gCAAO;;0CAAG;;;;;;;;;;;;kCAEjC,8OAAC;wBAAI,OAAO;4BAAE,WAAW;wBAAQ;;;0CAC7B,8OAAC;gCAAI,OAAO;oCAAE,UAAU;oCAAQ,OAAO;gCAAO;;0CAAG;;;;;;0CACjD,8OAAC;gCAAI,OAAO;oCAAE,YAAY;oCAAK,OAAO;gCAAO;;0CAAG;;;;;;;;;;;;;;;;;;0BAKxD,8OAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,qBAAqB;oBAAe,KAAK;oBAAQ,cAAc;gBAAO;0DAAa;;kCAG9G,8OAAC;wBAAI,OAAO;;;0CACR,8OAAC;gCAAI,OAAO;oCAAE,UAAU;oCAAQ,OAAO;oCAAQ,cAAc;gCAAM;;0CAAG;;;;;;0CACtE,8OAAC;gCAAI,OAAO;oCAAE,SAAS;oCAAQ,YAAY;oCAAY,KAAK;gCAAO;;;kDAC/D,8OAAC;wCAAK,OAAO;4CAAE,UAAU;4CAAQ,YAAY;4CAAK,OAAO;wCAAO;;kDAAI;;;;;;kDACpE,8OAAC;wCAAK,OAAO;4CACT,UAAU;4CACV,SAAS;4CACT,cAAc;4CACd,YAAY,UAAU,KAAK,GAAG;4CAC9B,OAAO,UAAU,KAAK;4CACtB,YAAY;wCAChB;;kDACK,UAAU,IAAI;;;;;;;;;;;;;;;;;;kCAM3B,8OAAC;wBAAI,OAAO;;;0CACR,8OAAC;gCAAI,OAAO;oCAAE,UAAU;oCAAQ,OAAO;oCAAQ,cAAc;gCAAM;;0CAAG;;;;;;0CACtE,8OAAC;gCAAI,OAAO;oCAAE,SAAS;oCAAQ,YAAY;oCAAY,KAAK;gCAAM;;;kDAC9D,8OAAC;wCAAK,OAAO;4CAAE,UAAU;4CAAQ,YAAY;4CAAK,OAAO;wCAAO;;kDAAI;;;;;;kDACpE,8OAAC;wCAAK,OAAO;4CAAE,UAAU;4CAAQ,OAAO;wCAAO;;kDAAG;;;;;;;;;;;;;;;;;;kCAK1D,8OAAC;wBAAI,OAAO;;;0CACR,8OAAC;gCAAI,OAAO;oCAAE,UAAU;oCAAQ,OAAO;oCAAQ,cAAc;gCAAM;;0CAAG;;;;;;0CACtE,8OAAC;gCAAI,OAAO;oCAAE,SAAS;oCAAQ,YAAY;oCAAY,KAAK;gCAAM;;;kDAC9D,8OAAC;wCAAK,OAAO;4CAAE,UAAU;4CAAQ,YAAY;4CAAK,OAAO;wCAAU;;kDAAI,KAAK,MAAM,GAAG,KAAK,YAAY;;;;;;kDACtG,8OAAC;wCAAK,OAAO;4CAAE,UAAU;4CAAQ,OAAO;wCAAO;;kDAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAa1E;AAEA,MAAM,WAAgC;IAClC,YAAY;IACZ,SAAS;IACT,cAAc;IACd,WAAW;IACX,SAAS;IACT,eAAe;IACf,gBAAgB;AACpB"}}]
}