{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/GamerPC/OneDrive/Desktop/diyet-sistem/app/admin/clients/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { supabase } from \"../../../utils/supabase\";\r\n\r\nexport default function ClientsPage() {\r\n    const [clients, setClients] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        fetchClients();\r\n    }, []);\r\n\r\n    async function fetchClients() {\r\n        setLoading(true);\r\n        const { data, error } = await supabase\r\n            .from('profiles')\r\n            .select('*')\r\n            .eq('role', 'client')\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (!error && data) {\r\n            setClients(data);\r\n        }\r\n        setLoading(false);\r\n    }\r\n\r\n    const handleDeleteClient = async (clientId: string, clientName: string) => {\r\n        if (!window.confirm(`${clientName} isimli danışanı silmek istediğinize emin misiniz? Bu işlem geri alınamaz ve o kişiye ait tüm veriler (diyet, gelişim, kilo, giriş hesabı) kalıcı olarak silinir.`)) return;\r\n\r\n        // Yerel verileri temizle (Güvenlik amaçlı)\r\n        localStorage.removeItem(`diet_${clientId}`);\r\n        localStorage.removeItem(`dietProgress_${clientId}`);\r\n        localStorage.removeItem(`weightLogs_${clientId}`);\r\n\r\n        // Supabase Silme İşlemi (DB tarafındaki CASCADE ve TRIGGER sayesinde her şeyi siler)\r\n        const { error, count } = await supabase\r\n            .from('profiles')\r\n            .delete({ count: 'exact' })\r\n            .eq('id', clientId);\r\n\r\n        if (error) {\r\n            console.error(\"Silme hatası:\", error);\r\n            alert(\"Silme işlemi başarısız: \" + error.message);\r\n        } else if (count === 0) {\r\n            alert(\"Uyarı: Kullanıcı veritabanında bulunamadı veya silme izniniz yok (RLS). Lütfen SQL politikalarını kontrol edin.\");\r\n        } else {\r\n            // Arayüzden kaldır\r\n            setClients(clients.filter(c => c.id !== clientId));\r\n            alert(\"Danışan ve tüm verileri başarıyla silindi.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div style={{ flex: 1, padding: \"50px\", display: \"flex\", flexDirection: \"column\" }}>\r\n\r\n                <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: \"40px\" }}>\r\n                    <div>\r\n                        <h1 style={{ fontSize: \"32px\", fontWeight: 700, color: \"#2c3e50\" }}>Danışan Yönetimi</h1>\r\n                        <p style={{ color: \"#7f8c8d\" }}>Sisteme kayıtlı tüm danışanlarınızın listesi ve analiz verileri.</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Clients Table */}\r\n                <div style={{ background: \"white\", borderRadius: \"20px\", overflowX: \"auto\", boxShadow: \"0 10px 20px rgba(0,0,0,0.02)\" }}>\r\n                    <table style={{ width: \"100%\", borderCollapse: \"collapse\" }}>\r\n                        <thead style={{ background: \"#fcfdfe\" }}>\r\n                            <tr style={{ textAlign: \"left\" }}>\r\n                                <th style={thStyle}>Ad Soyad</th>\r\n                                <th style={thStyle}>Boy</th>\r\n                                <th style={thStyle}>Kilo</th>\r\n                                <th style={thStyle}>VKI</th>\r\n                                <th style={thStyle}>BMH</th>\r\n                                <th style={thStyle}>Hedef</th>\r\n                                <th style={thStyle}>İşlemler</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {loading ? (\r\n                                <tr>\r\n                                    <td colSpan={7} style={{ padding: \"50px\", textAlign: \"center\", color: \"#95a5a6\" }}>\r\n                                        Yükleniyor...\r\n                                    </td>\r\n                                </tr>\r\n                            ) : clients.length > 0 ? clients.map((client) => {\r\n                                const bmi = (Number(client.weight) / ((Number(client.height) / 100) ** 2)).toFixed(1);\r\n                                const clientAge = Number(client.age) || 30; // Varsayılan 30 yaş\r\n                                const bmh = Math.round(10 * Number(client.weight) + 6.25 * Number(client.height) - 5 * clientAge + 5);\r\n\r\n                                return (\r\n                                    <tr key={client.id} style={{ borderBottom: \"1px solid #f1f1f1\" }}>\r\n                                        <td style={tdStyle}>\r\n                                            <div style={{ fontWeight: 700, color: \"#2c3e50\" }}>{client.full_name}</div>\r\n                                            <div style={{ fontSize: \"12px\", color: \"#95a5a6\" }}>{client.height} cm | {client.weight} kg</div>\r\n                                        </td>\r\n                                        <td style={tdStyle}>{client.height} cm</td>\r\n                                        <td style={tdStyle}>{client.weight} kg</td>\r\n                                        <td style={tdStyle}>\r\n                                            <span style={{\r\n                                                background: \"#f1f1f1\",\r\n                                                padding: \"4px 10px\",\r\n                                                borderRadius: \"20px\",\r\n                                                fontSize: \"13px\",\r\n                                                fontWeight: 600\r\n                                            }}>{bmi}</span>\r\n                                        </td>\r\n                                        <td style={tdStyle}>\r\n                                            <span style={{\r\n                                                background: \"#f8f9fa\",\r\n                                                color: \"#e67e22\",\r\n                                                padding: \"4px 10px\",\r\n                                                borderRadius: \"20px\",\r\n                                                fontSize: \"13px\",\r\n                                                fontWeight: 700\r\n                                            }}>{bmh} <span style={{ fontSize: \"10px\", color: \"#95a5a6\", fontWeight: \"normal\" }}>kcal</span></span>\r\n                                        </td>\r\n                                        <td style={tdStyle}>{client.target_weight} kg</td>\r\n                                        <td style={tdStyle}>\r\n                                            <div style={{ display: \"flex\", gap: \"10px\" }}>\r\n                                                <Link\r\n                                                    href={`/admin/clients/${client.id}/diet`}\r\n                                                    style={{\r\n                                                        textDecoration: \"none\",\r\n                                                        background: \"#79a33d\",\r\n                                                        color: \"white\",\r\n                                                        padding: \"8px 15px\",\r\n                                                        borderRadius: \"8px\",\r\n                                                        fontSize: \"13px\",\r\n                                                        fontWeight: 700\r\n                                                    }}\r\n                                                >\r\n                                                    Diyet Hazırla\r\n                                                </Link>\r\n                                                <button onClick={() => handleDeleteClient(client.id, client.full_name)} style={{ ...actionBtn, color: \"#e74c3c\", fontSize: \"14px\", fontWeight: \"bold\", padding: \"8px 15px\" }}>Sil</button>\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                );\r\n                            }) : (\r\n                                <tr>\r\n                                    <td colSpan={7} style={{ padding: \"50px\", textAlign: \"center\", color: \"#95a5a6\" }}>\r\n                                        Henüz kayıtlı danışan bulunmuyor.\r\n                                    </td>\r\n                                </tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nconst thStyle: React.CSSProperties = {\r\n    padding: \"20px\",\r\n    color: \"#95a5a6\",\r\n    fontSize: \"13px\",\r\n    textTransform: \"uppercase\",\r\n    letterSpacing: \"1px\",\r\n    fontWeight: 700\r\n};\r\n\r\nconst tdStyle: React.CSSProperties = {\r\n    padding: \"20px\",\r\n    color: \"#2c3e50\",\r\n    fontSize: \"15px\"\r\n};\r\n\r\nconst actionBtn: React.CSSProperties = {\r\n    background: \"none\",\r\n    border: \"none\",\r\n    cursor: \"pointer\",\r\n    fontSize: \"18px\",\r\n    padding: \"5px\",\r\n    borderRadius: \"5px\",\r\n    transition: \"background 0.3s\"\r\n};\r\n"],"names":[],"mappings":"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"}}]
}