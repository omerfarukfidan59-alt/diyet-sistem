(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,28821,e=>{"use strict";var a=e.i(43476),t=e.i(37902),s=e.i(71645),i=e.i(22016),n=e.i(18566),l=e.i(56426);function c(e){if(!e||"string"!=typeof e)return null;let a=e.trim().replace(",",".").match(/^([\d.]+)\s*(.*)?$/);if(!a)return null;let t=parseFloat(a[1]);if(isNaN(t))return null;let s=(a[2]||"").toLowerCase().trim();return["g","gr","gram"].includes(s)?s="gram":["adet","tane"].includes(s)&&(s="adet"),{amount:t,unit:s}}function r(){let e=(0,n.useParams)(),r=(0,n.useRouter)(),p=e?.id,[f,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(0),[g,j]=(0,s.useState)([]),[y,b]=(0,s.useState)({}),[N,w]=(0,s.useState)(!0),[k,v]=(0,s.useState)([{day:1,breakfast:[],lunch:[],dinner:[],snacks:[]}]);(0,s.useEffect)(()=>{p&&e();async function e(){w(!0);let{data:e}=await l.supabase.from("profiles").select("*").eq("id",p).single();e&&u(e);let{data:a}=await l.supabase.from("diets").select("*").eq("client_id",p).eq("is_active",!0).maybeSingle();a&&a.content&&v(a.content);let{data:t}=await l.supabase.from("food_library").select("*");t&&j(t);let{data:s}=await l.supabase.from("diet_progress").select("*").eq("client_id",p);if(s){let e={};s.forEach(a=>{e[a.day_number-1]={completed:a.is_completed,note:a.note}}),b(e)}w(!1)}},[p]);let S=(e,a,t,s)=>{v(i=>i.map((i,n)=>{if(n===m){let n=[...i[e]||[]];if(n[a]={...n[a],[t]:s},"portion"===t){let e=n[a].food,t=g.find(a=>a.name.toLowerCase()===String(e).toLowerCase());if(t){let e=function(e,a){if(!e||!a||!a.unit||void 0===a.cal)return null;let t=c(e),s=c(String(a.unit));if(!t||!s||0===s.amount)return null;let i=Number(a.cal);if(isNaN(i))return null;let n=!1;return(t.unit===s.unit||""===t.unit?n=!0:""===s.unit&&(n=!0),n)?Math.round(i*(t.amount/s.amount)):null}(String(s),t);null!==e&&(n[a].cal=e)}}return{...i,[e]:n}}return i}))},C=async()=>{if(!p)return;w(!0),await l.supabase.from("diets").update({is_active:!1}).eq("client_id",p);let{error:e}=await l.supabase.from("diets").insert([{client_id:p,title:`${k.length} G\xfcnl\xfck Program`,content:k,is_active:!0}]);e?alert("Diyet kaydedilemedi: "+e.message):(alert("Diyet listesi Supabase'e başarıyla kaydedildi!"),r.push("/admin/clients")),w(!1)};return N?(0,a.jsx)("div",{children:"Veriler yükleniyor..."}):f&&k[m]?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column"},className:"jsx-11e0cc8a9ea0fe70 diet-page-wrapper",children:[(0,a.jsx)(t.default,{id:"11e0cc8a9ea0fe70",children:".diet-page-wrapper.jsx-11e0cc8a9ea0fe70{padding:50px}@media (width<=1024px){.diet-page-wrapper.jsx-11e0cc8a9ea0fe70{padding:20px}}"}),(0,a.jsxs)("div",{style:{marginBottom:"40px"},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsx)(i.default,{href:"/admin/clients",style:{color:"#79a33d",textDecoration:"none",fontSize:"14px",fontWeight:700},children:"← Listeye Dön"}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsxs)("div",{className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsxs)("h1",{style:{fontSize:"32px",fontWeight:700,color:"#2c3e50"},className:"jsx-11e0cc8a9ea0fe70",children:["Diyet Hazırla: ",f.name]}),(0,a.jsx)("p",{style:{color:"#7f8c8d"},className:"jsx-11e0cc8a9ea0fe70",children:"Danışan için öğün detaylarını gün gün planlayabilirsiniz."})]}),(0,a.jsxs)("button",{onClick:C,style:x,className:"jsx-11e0cc8a9ea0fe70",children:["Diyet Listesini ",k.length," Günlük Kaydet"]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"10px",marginBottom:"25px",overflowX:"auto",paddingBottom:"10px"},className:"jsx-11e0cc8a9ea0fe70",children:[k.map((e,t)=>(0,a.jsxs)("div",{style:{position:"relative"},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsxs)("button",{onClick:()=>h(t),style:{padding:"12px 25px",background:m===t?"#79a33d":"white",color:m===t?"white":"#2c3e50",border:`1px solid ${m===t?"#79a33d":"#e0e0e0"} `,borderRadius:"10px",fontWeight:700,cursor:"pointer",transition:"all 0.2s"},className:"jsx-11e0cc8a9ea0fe70",children:[t+1,". Gün"]}),k.length>1&&(0,a.jsx)("button",{onClick:()=>(e=>{if(1===k.length)return alert("En az 1 gün olmalı!");let a=k.filter((a,t)=>t!==e).map((e,a)=>({...e,day:a+1}));v(a),h(Math.min(m,a.length-1))})(t),style:{position:"absolute",top:"-8px",right:"-8px",background:"#e74c3c",color:"white",border:"none",borderRadius:"50%",width:"22px",height:"22px",fontSize:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Günü Sil",className:"jsx-11e0cc8a9ea0fe70",children:"X"})]},t)),(0,a.jsx)("button",{onClick:()=>{v([...k,{day:k.length+1,breakfast:[],lunch:[],dinner:[],snacks:[]}]),h(k.length)},style:{padding:"12px 25px",background:"transparent",color:"#79a33d",border:"2px dashed #79a33d",borderRadius:"10px",fontWeight:700,cursor:"pointer"},className:"jsx-11e0cc8a9ea0fe70",children:"+ Yeni Gün Ekle"})]}),(0,a.jsxs)("div",{style:{marginBottom:"30px",background:y[m]?.completed?"#eaf2e3":"white",padding:"20px 30px",borderRadius:"15px",border:`1px solid ${y[m]?.completed?"#79a33d":"#eee"} `,display:"flex",alignItems:"flex-start",gap:"20px"},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsx)("div",{style:{fontSize:"24px",background:y[m]?.completed?"#79a33d":"#f0f0f0",color:y[m]?.completed?"white":"#ccc",width:"50px",height:"50px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-11e0cc8a9ea0fe70",children:y[m]?.completed?"✓":"!"}),(0,a.jsxs)("div",{style:{flex:1},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsx)("h3",{style:{fontSize:"16px",fontWeight:700,color:y[m]?.completed?"#3d5a2d":"#7f8c8d",marginBottom:"5px"},className:"jsx-11e0cc8a9ea0fe70",children:y[m]?.completed?"Danışan bu günü eksiksiz uyguladı!":"Bu gün için henüz onay verilmedi."}),y[m]?.note?(0,a.jsxs)("div",{style:{marginTop:"10px",padding:"15px",background:"white",borderRadius:"10px",fontSize:"14px",color:"#555",fontStyle:"italic",borderLeft:"4px solid #79a33d"},className:"jsx-11e0cc8a9ea0fe70",children:['"',y[m].note,'"']}):(0,a.jsx)("p",{style:{fontSize:"13px",color:"#95a5a6",marginTop:"5px"},className:"jsx-11e0cc8a9ea0fe70",children:"Danışan herhangi bir not bırakmadı."})]})]}),(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},className:"jsx-11e0cc8a9ea0fe70",children:["breakfast","lunch","dinner","snacks"].map(e=>(0,a.jsxs)("div",{style:{background:"white",padding:"30px",borderRadius:"20px",boxShadow:"0 10px 20px rgba(0,0,0,0.02)"},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsx)("h3",{style:{fontSize:"18px",fontWeight:700,color:"#3d5a2d",textTransform:"capitalize"},className:"jsx-11e0cc8a9ea0fe70",children:"breakfast"===e?"Kahvaltı":"lunch"===e?"Öğle Yemeği":"dinner"===e?"Akşam Yemeği":"Ara Öğünler"}),(0,a.jsx)("button",{onClick:()=>{v(a=>a.map((a,t)=>{if(t===m){let t=a[e]||[];return{...a,[e]:[...t,{food:"",portion:"",cal:0}]}}return a}))},style:o,className:"jsx-11e0cc8a9ea0fe70",children:"+ Satır Ekle"})]}),(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsx)("thead",{className:"jsx-11e0cc8a9ea0fe70",children:(0,a.jsxs)("tr",{style:{textAlign:"left",fontSize:"13px",color:"#95a5a6",textTransform:"uppercase"},className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsx)("th",{style:{padding:"10px",width:"40%"},className:"jsx-11e0cc8a9ea0fe70",children:"Besin"}),(0,a.jsx)("th",{style:{padding:"10px",width:"30%"},className:"jsx-11e0cc8a9ea0fe70",children:"Porsiyon"}),(0,a.jsx)("th",{style:{padding:"10px",width:"20%"},className:"jsx-11e0cc8a9ea0fe70",children:"Kalori"}),(0,a.jsx)("th",{style:{padding:"10px",width:"10%"},className:"jsx-11e0cc8a9ea0fe70"})]})}),(0,a.jsxs)("tbody",{className:"jsx-11e0cc8a9ea0fe70",children:[(k[m][e]||[]).map((t,s)=>(0,a.jsxs)("tr",{className:"jsx-11e0cc8a9ea0fe70",children:[(0,a.jsx)("td",{style:{padding:"5px"},className:"jsx-11e0cc8a9ea0fe70",children:(0,a.jsx)("input",{value:t.food,onChange:a=>{var t;let i;return t=a.target.value,i=g.find(e=>e.name.toLowerCase()===String(t).toLowerCase()),void v(a=>a.map((a,n)=>{if(n===m){let n=[...a[e]||[]];return n[s]={...n[s],food:t},i&&(n[s].portion=i.unit,n[s].cal=i.cal),{...a,[e]:n}}return a}))},list:"food-suggestions",style:d,placeholder:"Besin adı...",className:"jsx-11e0cc8a9ea0fe70"})}),(0,a.jsx)("td",{style:{padding:"5px"},className:"jsx-11e0cc8a9ea0fe70",children:(0,a.jsx)("input",{value:t.portion,onChange:a=>S(e,s,"portion",a.target.value),style:d,placeholder:"100g, 1 porsiyon...",className:"jsx-11e0cc8a9ea0fe70"})}),(0,a.jsx)("td",{style:{padding:"5px"},className:"jsx-11e0cc8a9ea0fe70",children:(0,a.jsx)("input",{type:"number",value:t.cal,onChange:a=>S(e,s,"cal",a.target.value),style:d,className:"jsx-11e0cc8a9ea0fe70"})}),(0,a.jsx)("td",{style:{padding:"5px",textAlign:"center"},className:"jsx-11e0cc8a9ea0fe70",children:(0,a.jsx)("button",{onClick:()=>{v(a=>a.map((a,t)=>{if(t===m){let t=[...a[e]||[]];return t.splice(s,1),{...a,[e]:t}}return a}))},style:{background:"none",border:"none",color:"#e74c3c",cursor:"pointer",fontWeight:700},className:"jsx-11e0cc8a9ea0fe70",children:"Sil"})})]},s)),0===(k[m][e]||[]).length&&(0,a.jsx)("tr",{className:"jsx-11e0cc8a9ea0fe70",children:(0,a.jsx)("td",{colSpan:4,style:{padding:"20px",textAlign:"center",color:"#95a5a6",fontSize:"14px"},className:"jsx-11e0cc8a9ea0fe70",children:"Bu öğüne henüz besin eklenmedi."})})]})]})]},e))}),(0,a.jsx)("datalist",{id:"food-suggestions",className:"jsx-11e0cc8a9ea0fe70",children:g.map((e,t)=>(0,a.jsx)("option",{value:e.name,className:"jsx-11e0cc8a9ea0fe70"},t))})]})}):(0,a.jsx)("div",{children:"Hata: Danışan bulunamadı."})}let d={width:"100%",padding:"10px 15px",borderRadius:"8px",border:"1px solid #eee",fontSize:"14px",color:"#333",fontWeight:600},o={background:"none",border:"1px solid #79a33d",color:"#79a33d",padding:"8px 15px",borderRadius:"8px",fontWeight:700,cursor:"pointer"},x={background:"#79a33d",color:"white",border:"none",padding:"15px 40px",borderRadius:"10px",fontSize:"16px",fontWeight:700,cursor:"pointer",boxShadow:"0 10px 20px rgba(121, 163, 61, 0.2)"};e.s(["default",()=>r],28821)}]);