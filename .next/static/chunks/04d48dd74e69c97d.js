(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,28821,e=>{"use strict";var t=e.i(43476),n=e.i(71645),i=e.i(22016),l=e.i(18566),a=e.i(56426);function r(e){if(!e||"string"!=typeof e)return null;let t=e.trim().replace(",",".").match(/^([\d.]+)\s*(.*)?$/);if(!t)return null;let n=parseFloat(t[1]);if(isNaN(n))return null;let i=(t[2]||"").toLowerCase().trim();return["g","gr","gram"].includes(i)?i="gram":["adet","tane"].includes(i)&&(i="adet"),{amount:n,unit:i}}function d(){let e=(0,l.useParams)(),d=(0,l.useRouter)(),p=e?.id,[x,u]=(0,n.useState)(null),[h,g]=(0,n.useState)(0),[f,m]=(0,n.useState)([]),[y,b]=(0,n.useState)({}),[j,k]=(0,n.useState)(!0),[v,S]=(0,n.useState)([{day:1,breakfast:[],lunch:[],dinner:[],snacks:[]}]);(0,n.useEffect)(()=>{p&&e();async function e(){k(!0);let{data:e}=await a.supabase.from("profiles").select("*").eq("id",p).single();e&&u(e);let{data:t}=await a.supabase.from("diets").select("*").eq("client_id",p).eq("is_active",!0).maybeSingle();t&&t.content&&S(t.content);let{data:n}=await a.supabase.from("food_library").select("*");n&&m(n);let{data:i}=await a.supabase.from("diet_progress").select("*").eq("client_id",p);if(i){let e={};i.forEach(t=>{e[t.day_number-1]={completed:t.is_completed,note:t.note}}),b(e)}k(!1)}},[p]);let w=(e,t,n,i)=>{S(l=>l.map((l,a)=>{if(a===h){let a=[...l[e]||[]];if(a[t]={...a[t],[n]:i},"portion"===n){let e=a[t].food,n=f.find(t=>t.name===e);if(n){let e=function(e,t){if(!e||!t||!t.unit||void 0===t.cal)return null;let n=r(e),i=r(String(t.unit));if(!n||!i||0===i.amount)return null;let l=Number(t.cal);if(isNaN(l))return null;let a=!1;return(n.unit===i.unit||""===n.unit?a=!0:""===i.unit&&(a=!0),a)?Math.round(l*(n.amount/i.amount)):null}(String(i),n);null!==e&&(a[t].cal=e)}}return{...l,[e]:a}}return l}))},z=async()=>{if(!p)return;k(!0),await a.supabase.from("diets").update({is_active:!1}).eq("client_id",p);let{error:e}=await a.supabase.from("diets").insert([{client_id:p,title:`${v.length} G\xfcnl\xfck Program`,content:v,is_active:!0}]);e?alert("Diyet kaydedilemedi: "+e.message):(alert("Diyet listesi Supabase'e başarıyla kaydedildi!"),d.push("/admin/clients")),k(!1)};return j?(0,t.jsx)("div",{children:"Veriler yükleniyor..."}):x&&v[h]?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{style:{flex:1,padding:"50px",display:"flex",flexDirection:"column"},children:[(0,t.jsxs)("div",{style:{marginBottom:"40px"},children:[(0,t.jsx)(i.default,{href:"/admin/clients",style:{color:"#79a33d",textDecoration:"none",fontSize:"14px",fontWeight:700},children:"← Listeye Dön"}),(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"},children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{style:{fontSize:"32px",fontWeight:700,color:"#2c3e50"},children:["Diyet Hazırla: ",x.name]}),(0,t.jsx)("p",{style:{color:"#7f8c8d"},children:"Danışan için öğün detaylarını gün gün planlayabilirsiniz."})]}),(0,t.jsxs)("button",{onClick:z,style:c,children:["Diyet Listesini ",v.length," Günlük Kaydet"]})]})]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"10px",marginBottom:"25px",overflowX:"auto",paddingBottom:"10px"},children:[v.map((e,n)=>(0,t.jsxs)("div",{style:{position:"relative"},children:[(0,t.jsxs)("button",{onClick:()=>g(n),style:{padding:"12px 25px",background:h===n?"#79a33d":"white",color:h===n?"white":"#2c3e50",border:`1px solid ${h===n?"#79a33d":"#e0e0e0"} `,borderRadius:"10px",fontWeight:700,cursor:"pointer",transition:"all 0.2s"},children:[n+1,". Gün"]}),v.length>1&&(0,t.jsx)("button",{onClick:()=>(e=>{if(1===v.length)return alert("En az 1 gün olmalı!");let t=v.filter((t,n)=>n!==e).map((e,t)=>({...e,day:t+1}));S(t),g(Math.min(h,t.length-1))})(n),style:{position:"absolute",top:"-8px",right:"-8px",background:"#e74c3c",color:"white",border:"none",borderRadius:"50%",width:"22px",height:"22px",fontSize:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Günü Sil",children:"X"})]},n)),(0,t.jsx)("button",{onClick:()=>{S([...v,{day:v.length+1,breakfast:[],lunch:[],dinner:[],snacks:[]}]),g(v.length)},style:{padding:"12px 25px",background:"transparent",color:"#79a33d",border:"2px dashed #79a33d",borderRadius:"10px",fontWeight:700,cursor:"pointer"},children:"+ Yeni Gün Ekle"})]}),(0,t.jsxs)("div",{style:{marginBottom:"30px",background:y[h]?.completed?"#eaf2e3":"white",padding:"20px 30px",borderRadius:"15px",border:`1px solid ${y[h]?.completed?"#79a33d":"#eee"} `,display:"flex",alignItems:"flex-start",gap:"20px"},children:[(0,t.jsx)("div",{style:{fontSize:"24px",background:y[h]?.completed?"#79a33d":"#f0f0f0",color:y[h]?.completed?"white":"#ccc",width:"50px",height:"50px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:y[h]?.completed?"✓":"!"}),(0,t.jsxs)("div",{style:{flex:1},children:[(0,t.jsx)("h3",{style:{fontSize:"16px",fontWeight:700,color:y[h]?.completed?"#3d5a2d":"#7f8c8d",marginBottom:"5px"},children:y[h]?.completed?"Danışan bu günü eksiksiz uyguladı!":"Bu gün için henüz onay verilmedi."}),y[h]?.note?(0,t.jsxs)("div",{style:{marginTop:"10px",padding:"15px",background:"white",borderRadius:"10px",fontSize:"14px",color:"#555",fontStyle:"italic",borderLeft:"4px solid #79a33d"},children:['"',y[h].note,'"']}):(0,t.jsx)("p",{style:{fontSize:"13px",color:"#95a5a6",marginTop:"5px"},children:"Danışan herhangi bir not bırakmadı."})]})]}),(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:["breakfast","lunch","dinner","snacks"].map(e=>(0,t.jsxs)("div",{style:{background:"white",padding:"30px",borderRadius:"20px",boxShadow:"0 10px 20px rgba(0,0,0,0.02)"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,t.jsx)("h3",{style:{fontSize:"18px",fontWeight:700,color:"#3d5a2d",textTransform:"capitalize"},children:"breakfast"===e?"Kahvaltı":"lunch"===e?"Öğle Yemeği":"dinner"===e?"Akşam Yemeği":"Ara Öğünler"}),(0,t.jsx)("button",{onClick:()=>{S(t=>t.map((t,n)=>{if(n===h){let n=t[e]||[];return{...t,[e]:[...n,{food:"",portion:"",cal:0}]}}return t}))},style:s,children:"+ Satır Ekle"})]}),(0,t.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{style:{textAlign:"left",fontSize:"13px",color:"#95a5a6",textTransform:"uppercase"},children:[(0,t.jsx)("th",{style:{padding:"10px",width:"40%"},children:"Besin"}),(0,t.jsx)("th",{style:{padding:"10px",width:"30%"},children:"Porsiyon"}),(0,t.jsx)("th",{style:{padding:"10px",width:"20%"},children:"Kalori"}),(0,t.jsx)("th",{style:{padding:"10px",width:"10%"}})]})}),(0,t.jsxs)("tbody",{children:[(v[h][e]||[]).map((n,i)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{style:{padding:"5px"},children:(0,t.jsx)("input",{value:n.food,onChange:t=>{var n;let l;return n=t.target.value,l=f.find(e=>e.name===n),void S(t=>t.map((t,a)=>{if(a===h){let a=[...t[e]||[]];return a[i]={...a[i],food:n},l&&(a[i].portion=l.unit,a[i].cal=l.cal),{...t,[e]:a}}return t}))},list:"food-suggestions",style:o,placeholder:"Besin adı..."})}),(0,t.jsx)("td",{style:{padding:"5px"},children:(0,t.jsx)("input",{value:n.portion,onChange:t=>w(e,i,"portion",t.target.value),style:o,placeholder:"100g, 1 porsiyon..."})}),(0,t.jsx)("td",{style:{padding:"5px"},children:(0,t.jsx)("input",{type:"number",value:n.cal,onChange:t=>w(e,i,"cal",t.target.value),style:o})}),(0,t.jsx)("td",{style:{padding:"5px",textAlign:"center"},children:(0,t.jsx)("button",{onClick:()=>{S(t=>t.map((t,n)=>{if(n===h){let n=[...t[e]||[]];return n.splice(i,1),{...t,[e]:n}}return t}))},style:{background:"none",border:"none",color:"#e74c3c",cursor:"pointer",fontWeight:700},children:"Sil"})})]},i)),0===(v[h][e]||[]).length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:4,style:{padding:"20px",textAlign:"center",color:"#95a5a6",fontSize:"14px"},children:"Bu öğüne henüz besin eklenmedi."})})]})]})]},e))}),(0,t.jsx)("datalist",{id:"food-suggestions",children:f.map((e,n)=>(0,t.jsx)("option",{value:e.name},n))})]})}):(0,t.jsx)("div",{children:"Hata: Danışan bulunamadı."})}let o={width:"100%",padding:"10px 15px",borderRadius:"8px",border:"1px solid #eee",fontSize:"14px",color:"#333",fontWeight:600},s={background:"none",border:"1px solid #79a33d",color:"#79a33d",padding:"8px 15px",borderRadius:"8px",fontWeight:700,cursor:"pointer"},c={background:"#79a33d",color:"white",border:"none",padding:"15px 40px",borderRadius:"10px",fontSize:"16px",fontWeight:700,cursor:"pointer",boxShadow:"0 10px 20px rgba(121, 163, 61, 0.2)"};e.s(["default",()=>d],28821)}]);